# Visseqsnip

Welcome!
This repo houses a python package `visseqsnip` that is used to process the output from the visseq pipeline into formats usable by machine learning and computer vision pipelines.

## Installation

This package can be installed directly from GitHub using:

```
pip install git+https://github.com/Lilferrit/visseqsnip
```

Alternatively, the package can be cloned and installed locally.

## Usage

### Make WebDataset

The `visseqsnip` package includes a command-line utility called `visseq-webdataset` that converts per-cell metadata and multi-channel TIFF images into [WebDataset](https://github.com/webdataset/webdataset) shards for efficient training workflows.

#### Example usage

```bash
visseq-webdataset \
  --cell_file_path path/to/cells_full.csv \
  --phenotyping_root_dir path/to/image_root \
  --output_dir path/to/output_shards \
  --n_shards 10 \
  --log_file_path visseq_conversion.log
```

#### Options

- `--cell_file_path`: Path to the `.cells_full.csv` or `.parquet` metadata file.
- `--phenotyping_root_dir`: Root directory containing the TIFF images.
- `--output_dir`: Destination directory for the `.tar` WebDataset shards.
- `--adjust_path`: Whether to strip `phenotyping/output/` from image paths (default: `True`).
- `--filter_cell_profiler`: Filter out columns generated by CellProfiler (those starting with uppercase letters).
- `--n_shards`: Number of output shards to generate.
- `--log_file_path`: Optional path to save a log file with progress and errors.

Each WebDataset sample includes:
- A grayscale PNG image for each channel (`nucleus.png`, `target_protein.png`, `cytoplasm.png`)
- A `meta_data.json` file with per-cell metadata